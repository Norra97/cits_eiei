async function approveRequest(reqId) {
    try {
        const lecturerName = localStorage.getItem('username');
        if (!lecturerName) {
            throw new Error('Lecturer username not found. Please login again.');
        }

        console.log('Approving request:', reqId, 'by lecturer:', lecturerName);
        
        const response = await fetch(`/approve-borrow-request/${reqId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                lecturerName: lecturerName
            })
        });

        console.log('Response status:', response.status);
        const result = await response.json();
        console.log('Response data:', result);
        
        if (!response.ok) {
            throw new Error(result.message || 'Failed to approve request');
        }

        alert(result.message);
        await fetchBorrowingRequests();
    } catch (error) {
        console.error('Error details:', error);
        console.error('Error stack:', error.stack);
        alert(error.message || 'Failed to approve request!');
    }
}

async function fetchBorrowingRequests() {
    try {
        const response = await fetch('/borrow-assett');
        if (!response.ok) {
            throw new Error('Failed to fetch borrowing requests');
        }
        const data = await response.json();
        console.log('Fetched borrowing requests:', data);
        
        const pendingRequests = data.filter(request => request.Status === 'Pending');
        console.log('Pending requests:', pendingRequests);
        
        // Update UI with pending requests
        const tableBody = document.querySelector('#borrowingRequestsTable tbody');
        if (tableBody) {
            tableBody.innerHTML = '';
            pendingRequests.forEach(request => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${request.ReqID}</td>
                    <td>${request.Borrowname}</td>
                    <td>${request.AssetName}</td>
                    <td>${request.BorrowDate}</td>
                    <td>${request.ReturnDate}</td>
                    <td>${request.Status}</td>
                    <td>
                        <button onclick="approveRequest('${request.ReqID}')" class="btn btn-success">Approve</button>
                        <button onclick="rejectRequest('${request.ReqID}')" class="btn btn-danger">Reject</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
    } catch (error) {
        console.error('Error fetching borrowing requests:', error);
        alert('Failed to load borrowing requests');
    }
} 